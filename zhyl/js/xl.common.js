/*----------------------------------------
* Copyright (c) 2014 仙朗科技
* 网站：http://www.0ananas0.com
* Date: 2014-11-28
* Creater:Cqy
----------------------------------------*/
var virtualdata = {
    autocompletedata: [{ Id: "4", value: "李爱军" },
        { Id: "7", value: "张建军" },
        { Id: "8", value: "张朝飞" },
        { Id: "9", value: "管理员" },
        { Id: "10", value: "赵小明"}],
    datatabledata1: [
        {
            Id: "4",
            UserNo: "00000088",
            UserName: "李爱军",
            cName: "宁联建筑",
            wName: "瓦工",
            TotalCount: "46",
            NormalCount: "0",
            AbnormalCount: "4"
        },
        {
            Id: "4",
            UserNo: "00000088",
            UserName: "李爱军",
            cName: "宁联建筑",
            wName: "瓦工",
            TotalCount: "46",
            NormalCount: "0",
            AbnormalCount: "4"
        },
        {
            Id: "4",
            UserNo: "00000088",
            UserName: "李爱军",
            cName: "宁联建筑",
            wName: "瓦工",
            TotalCount: "46",
            NormalCount: "0",
            AbnormalCount: "4"
        }
    ],
    datatabledata: [
        {
            Id: "4",
            UserNo: "00000088",
            UserName: "李爱军",
            cName: "宁联建筑",
            wName: "瓦工",
            TotalCount: "46",
            NormalCount: "0",
            AbnormalCount: "4"
        },
        {
            Id: "4",
            UserNo: "00000088",
            UserName: "李爱军",
            cName: "宁联建筑",
            wName: "瓦工",
            TotalCount: "46",
            NormalCount: "0",
            AbnormalCount: "4"
        },
        {
            Id: "4",
            UserNo: "00000088",
            UserName: "李爱军",
            cName: "宁联建筑",
            wName: "瓦工",
            TotalCount: "46",
            NormalCount: "0",
            AbnormalCount: "4"
        },
        {
            Id: "4",
            UserNo: "00000088",
            UserName: "李爱军",
            cName: "宁联建筑",
            wName: "瓦工",
            TotalCount: "46",
            NormalCount: "0",
            AbnormalCount: "4"
        },
        {
            Id: "4",
            UserNo: "00000088",
            UserName: "李爱军",
            cName: "宁联建筑",
            wName: "瓦工",
            TotalCount: "46",
            NormalCount: "0",
            AbnormalCount: "4"
        },
        {
            Id: "4",
            UserNo: "00000088",
            UserName: "李爱军",
            cName: "宁联建筑",
            wName: "瓦工",
            TotalCount: "46",
            NormalCount: "0",
            AbnormalCount: "4"
        },
        {
            Id: "4",
            UserNo: "00000088",
            UserName: "李爱军",
            cName: "宁联建筑",
            wName: "瓦工",
            TotalCount: "46",
            NormalCount: "0",
            AbnormalCount: "4"
        },
        {
            Id: "4",
            UserNo: "00000088",
            UserName: "李爱军",
            cName: "宁联建筑",
            wName: "瓦工",
            TotalCount: "46",
            NormalCount: "0",
            AbnormalCount: "4"
        },
        {
            Id: "4",
            UserNo: "00000088",
            UserName: "李爱军",
            cName: "宁联建筑",
            wName: "瓦工",
            TotalCount: "46",
            NormalCount: "0",
            AbnormalCount: "4"
        }, {
            Id: "4",
            UserNo: "00000088",
            UserName: "李爱军",
            cName: "宁联建筑",
            wName: "瓦工",
            TotalCount: "46",
            NormalCount: "0",
            AbnormalCount: "4"
        },
        {
            Id: "4",
            UserNo: "00000088",
            UserName: "李爱军",
            cName: "宁联建筑",
            wName: "瓦工",
            TotalCount: "46",
            NormalCount: "0",
            AbnormalCount: "4"
        },
        {
            Id: "4",
            UserNo: "00000088",
            UserName: "李爱军",
            cName: "宁联建筑",
            wName: "瓦工",
            TotalCount: "46",
            NormalCount: "0",
            AbnormalCount: "4"
        },
        {
            Id: "5",
            UserNo: "00000010",
            UserName: "李爱军1",
            cName: "宁联",
            wName: "瓦工",
            TotalCount: "46",
            NormalCount: "12",
            AbnormalCount: "4"
        }
    ],
    treedata: [
        { id: 1, pId: 0, name: "随意勾选 1", open: true },
        { id: 11, pId: 1, name: "随意勾选 1-1", open: true },
        { id: 111, pId: 11, name: "随意勾选 1-1-1" },
        { id: 112, pId: 11, name: "随意勾选 1-1-2" },
        { id: 12, pId: 1, name: "随意勾选 1-2", open: true },
        { id: 121, pId: 12, name: "随意勾选 1-2-1" },
        { id: 122, pId: 12, name: "随意勾选 1-2-2" },
        { id: 2, pId: 0, name: "随意勾选 2", checked: true, open: true },
        { id: 21, pId: 2, name: "随意勾选 2-1" },
        { id: 22, pId: 2, name: "随意勾选 2-2", open: true },
        { id: 221, pId: 22, name: "随意勾选 2-2-1", checked: true },
        { id: 222, pId: 22, name: "随意勾选 2-2-2" },
        { id: 23, pId: 2, name: "随意勾选 2-3" }
    ],
    pageingdata:[{"Id":215,"Name":"英语数字歌","Author":"园长","SchoolName":null,"CreatedDate":"2015/2/12 10:57:02","Source":"","MusicChannelName":"英文儿歌","DownLoadCount":82},{"Id":214,"Name":"YanKee","Author":"园长","SchoolName":null,"CreatedDate":"2015/2/12 10:56:26","Source":"","MusicChannelName":"英文儿歌","DownLoadCount":13},{"Id":213,"Name":"See You Baby","Author":"园长","SchoolName":null,"CreatedDate":"2015/2/12 10:56:08","Source":"","MusicChannelName":"英文儿歌","DownLoadCount":28},{"Id":212,"Name":"Five Big Dump","Author":"园长","SchoolName":null,"CreatedDate":"2015/2/12 10:55:38","Source":"","MusicChannelName":"英文儿歌","DownLoadCount":31},{"Id":211,"Name":"The Finger","Author":"园长","SchoolName":null,"CreatedDate":"2015/2/12 10:54:48","Source":"","MusicChannelName":"英文儿歌","DownLoadCount":75},{"Id":210,"Name":"London Bridge","Author":"园长","SchoolName":null,"CreatedDate":"2015/2/12 10:54:15","Source":"","MusicChannelName":"英文儿歌","DownLoadCount":44},{"Id":209,"Name":"哆来咪","Author":"园长","SchoolName":null,"CreatedDate":"2015/2/12 10:53:13","Source":"","MusicChannelName":"英文儿歌","DownLoadCount":28},{"Id":208,"Name":"圣诞歌","Author":"园长","SchoolName":null,"CreatedDate":"2015/2/12 10:52:50","Source":"","MusicChannelName":"英文儿歌","DownLoadCount":55},{"Id":207,"Name":"bingo","Author":"园长","SchoolName":null,"CreatedDate":"2015/2/12 10:52:28","Source":"","MusicChannelName":"英文儿歌","DownLoadCount":33},{"Id":206,"Name":"玛丽有只绵羊","Author":"园长","SchoolName":null,"CreatedDate":"2015/2/12 10:52:08","Source":"","MusicChannelName":"英文儿歌","DownLoadCount":35},{"Id":205,"Name":"我的好妈妈","Author":"园长","SchoolName":null,"CreatedDate":"2015/2/12 0:00:00","Source":"","MusicChannelName":"精品童谣","DownLoadCount":49},{"Id":204,"Name":"机器猫","Author":"园长","SchoolName":null,"CreatedDate":"2015/2/12 0:00:00","Source":"","MusicChannelName":"精品童谣","DownLoadCount":37},{"Id":203,"Name":"世上只有妈妈好","Author":"园长","SchoolName":null,"CreatedDate":"2015/2/12 0:00:00","Source":"","MusicChannelName":"精品童谣","DownLoadCount":42},{"Id":202,"Name":"鲁冰花","Author":"园长","SchoolName":null,"CreatedDate":"2015/2/12 0:00:00","Source":"","MusicChannelName":"精品童谣","DownLoadCount":32},{"Id":201,"Name":"摇篮曲","Author":"园长","SchoolName":null,"CreatedDate":"2015/2/12 0:00:00","Source":"","MusicChannelName":"精品童谣","DownLoadCount":7},{"Id":200,"Name":"生日歌","Author":"园长","SchoolName":null,"CreatedDate":"2015/2/12 10:47:59","Source":"","MusicChannelName":"精品童谣","DownLoadCount":28},{"Id":199,"Name":"虫儿飞","Author":"园长","SchoolName":null,"CreatedDate":"2015/2/12 10:47:36","Source":"","MusicChannelName":"精品童谣","DownLoadCount":6},{"Id":198,"Name":"学习雷锋好榜样","Author":"园长","SchoolName":null,"CreatedDate":"2015/2/12 10:46:42","Source":"","MusicChannelName":"精品童谣","DownLoadCount":2},{"Id":197,"Name":"小小少年","Author":"园长","SchoolName":null,"CreatedDate":"2015/2/12 10:46:00","Source":"","MusicChannelName":"精品童谣","DownLoadCount":6},{"Id":196,"Name":"小熊维尼","Author":"园长","SchoolName":null,"CreatedDate":"2015/2/12 10:44:41","Source":"","MusicChannelName":"动画片","DownLoadCount":11}]
}

var xl = {
    //获取id元素
    $: function (id) {
        return document.getElementById(id);
    },
    getdata: function getdata(ajaxUrl, parameter) {
        var result = null;
        $.ajax({
            type: "post",
            url: ajaxUrl,
            data: parameter,
            async: false,
            success: function (data) {
                if (typeof (data) == "string")
                    result = xl.toJson(data);
                else
                    result = data;

            }
        });
        return result;
    },
    toJson: function (data) {
        return data == "" ? null : eval('(' + unescape(data.replace(/\\/g, "%")) + ')') || [];
    }
}
var x = xl;

/*控件库 by:cqy 2015-2-28*/
(function ($) {
    /*左右侧浮动层*/
    $.fn.scrollBar = function (settings) {
        if ($(this).length == 0) return;
        var defaultSettings = {
            dir: "right",
            top: 100,
            padding:0,
            close: null,
            fix: false,
            contentall: true,
            fixleftright: false,
            fixleft: false, //为侧边栏不显示
            contentWidth: 980, //不贴边时当窗口缩小时保持980的中间宽度（最大宽度小于此宽度出现滚动条）
            inside:50,
            inpadding:10
            //areawidth: 1 //1:左右浮动层贴边 //1070:不贴边左右中间宽度为1070（滚动条的最小宽度）
        }
        var options = $.extend(true, defaultSettings, settings);
        var scrollel = this[0];
        var scrollBar=function(scrollEl, options){
            var dir = options.dir;
            var headHeight = options.top;
            //var areaWidth = options.areawidth;
            var inside=options.inside;
            var padding = options.padding;
            var inpadding=options.inpadding;
            //var iscontnet = options.contentall;
            var contentwidth = options.contentWidth;
            //滚动框宽高
            var scrollBar = scrollEl;
            var barWidth = scrollBar.offsetWidth;
            //可视区宽高
            var pageWidth = document.documentElement.clientWidth;
            var scrollWidth=document.documentElement.scrollWidth;
            if (options.fix) {
                scrollBar.style.position = 'fixed';
                if (dir == 'left') {
                    scrollBar.style.left = padding + 'px';
                }
                if (dir == 'right') {
                    scrollBar.style.right = padding + 'px';
                }
                scrollBar.style.top = headHeight + 'px';
            } else {
                scrollBar.style.position = 'absolute';
                scrollBar.style.top = headHeight + 'px';
            }
            if (options.fixleftright)
                return;
            //无视主体内容-左右
            var spacewidth = (pageWidth - contentwidth) / 2;
            var areaWidth=contentwidth+inside*2;
            if (dir == 'left' && inside == 1) {
                if (options.fixleft)
                    return;
                scrollBar.style.left = padding + 'px';
            } else if (dir == 'right' && inside == 1) {
                if(options.fix)
                    scrollBar.style.right=padding + 'px';
                else
                    scrollBar.style.right=(pageWidth-scrollWidth)+padding + 'px';
                //根据主体内容宽-左右
            } else if (dir == 'left' && inside != 1) {
                if(spacewidth>(barWidth+inside))
                {
                    scrollBar.style.left = (pageWidth - areaWidth) / 2 - barWidth+ 'px';
                }else if(spacewidth<=(barWidth+inside)&&spacewidth>=barWidth)
                {
                    scrollBar.style.left=0+"px";
                }else
                {
                    scrollBar.style.left = (pageWidth - contentwidth) / 2 - barWidth-inpadding + 'px';
                }
            } else if (dir == 'right' && inside != 1) {
                if(spacewidth>(barWidth+inside))
                {
                    scrollBar.style.right = (pageWidth - areaWidth) / 2 - barWidth + 'px';
                }else if(spacewidth<=(barWidth+inside)&&spacewidth>=barWidth)
                {
                    scrollBar.style.right=0+"px";
                }else
                {
                    if(options.fix)
                        scrollBar.style.right = (pageWidth - contentwidth) / 2 - barWidth-inpadding + 'px';
                    else
                    {
                        if(pageWidth<contentwidth)
                            scrollBar.style.right=(pageWidth-scrollWidth)-barWidth-inpadding+ 'px';
                        else
                           scrollBar.style.right = (pageWidth - contentwidth) / 2 - barWidth-inpadding + 'px';
                    }

                }
            }
        }

        scrollBar(scrollel, options);
        //返回顶部
        document.documentElement.scrollTop = 0;
        document.body.scrollTop = 0;
        $(window).resize(function () {
            var newopt = $.extend(true, {}, options);
            scrollBar(scrollel, newopt);
        });

        //关闭浮动层
        if (options.close != null) {
            options.close.click(function () {
                $(scrollel).remove();
            });
        }

        return this;
    };

    /* 图片自动播放*/
    $.fn.extend({
        picplay: function (options) {
            //默认参数
            var defaults = {
                /**轮换间隔时间，单位毫秒*/
                during: 3000,
                fadetime: 1000,
                /**是否显示左右按钮*/
                btn: true,
                /**是否显示焦点按钮*/
                focus: true,
                /**是否显示标题*/
                title: true,
                /**是否自动播放*/
                auto: true
            }
            var options = $.extend(defaults, options);

            return this.each(function () {
                var o = options;
                var curr_index = 0;
                var $this = $(this);
                var $li = $this.find("li");
                var li_count = $li.length;
                var fadeShow = function (el, time) {
                    $(el).index() == 1 ? curr_index++ : curr_index--;
                    if (curr_index >= li_count) curr_index = 0;
                    if (curr_index < 0) curr_index = li_count - 1;
                    //$li.eq(curr_index).fadeIn(options.fadetime);
                    //$li.not($li.eq(curr_index)).fadeOut(options.fadetime);
                    $li.eq(curr_index).stop().fadeTo(time, 1);
                    $li.not($li.eq(curr_index)).stop().fadeTo(time, 0);
                    $f.eq(curr_index).addClass("hover");
                    $f.not($f.eq(curr_index)).removeClass("hover");
                    $title.text($li.eq(curr_index).find("img").attr("alt"));
                    $title.attr("title", $li.eq(curr_index).find("img").attr("alt"));
                    $title.attr("href", $li.eq(curr_index).find("a").attr("href"));
                }
                $this.css({ position: 'relative', overflow: 'hidden', width: $li.find("img").width(), height: $li.find("img").height() });
                //$this.find("li").css({ position: 'absolute', left: 0, top: 0 }).hide();
                //$li.first().show();
                $this.find("li").css({ opacity: 0 });
                $li.first().css({ opacity: 1 });
                $this.append('<div class="yx-rotaion-btn"><span class="left_btn"><\/span><span class="right_btn"></span><\/div>');
                if (!o.btn) $(".yx-rotaion-btn").css({ visibility: 'hidden' });
                if (o.title) $this.append(' <div class="yx-rotation-title"><\/div><a href="javascript:void(0)" class="yx-rotation-t"><\/a>');
                if (o.focus) $this.append('<div class="yx-rotation-focus"><\/div>');
                var $btn = $(".yx-rotaion-btn span"), $title = $(".yx-rotation-t"), $title_bg = $(".yx-rotation-title"), $focus = $(".yx-rotation-focus");
                //如果自动播放，设置定时器
                if (o.auto) var t = setInterval(function () { /*$btn.last().click()*/fadeShow($btn.last(), options.fadetime); }, o.during);
                $title.attr("title", $li.first().find("img").attr("alt"));
                $title.text($li.first().find("img").attr("alt"));
                $title.attr("href", $li.first().find("a").attr("href"));

                // 输出焦点按钮
                for (i = 1; i <= li_count; i++) {
                    $focus.append('<span>' + i + '</span>');
                }
                // 兼容IE6透明图片
                if ($.browser.msie && $.browser.version == "6.0") {
                    $btn.add($focus.children("span")).css({ backgroundImage: 'url(images/ico.gif)' });
                }
                var $f = $focus.children("span");
                $f.first().addClass("hover");
                // 鼠标覆盖左右按钮设置透明度
                $btn.hover(function () {
                    $(this).addClass("hover");
                }, function () {
                    $(this).removeClass("hover");
                });
                //鼠标覆盖元素，清除计时器
                $btn.add($li).add($f).hover(function () {
                    if (t) clearInterval(t);
                }, function () {
                    if (o.auto) t = setInterval(function () { fadeShow($btn.last(), options.fadetime); }, o.during);
                });
                //鼠标覆盖焦点按钮效果
                $f.bind("mouseover", function () {
                    var i = $(this).index();
                    $(this).addClass("hover");
                    $focus.children("span").not($(this)).removeClass("hover");
                    //$li.eq(i).fadeIn(options.fadetime);
                    //$li.not($li.eq(i)).fadeOut(options.fadetime);
                    $li.eq(i).stop().fadeTo(options.fadetime, 1);
                    $li.not($li.eq(i)).stop().fadeTo(options.fadetime, 0);
                    $title.text($li.eq(i).find("img").attr("alt"));
                    $title.attr("title", $li.eq(i).find("img").attr("alt"));
                    curr_index = i;
                });

                //鼠标点击左右按钮效果
                $btn.bind("click", function () {
                    fadeShow(this, 0);
                });

            });
        }
    });


    /*带背景文字的输入框*/
    $.fn.holdinput = function (settings) {
        if ($(this).length == 0) return;
        var searchBox = $(this), searchBoxHovered = false, searchBoxFocused = false;
        if (!($.browser.msie && parseInt($.browser.version) < 10)) {
            $.each(searchBox, function () {
                $(this).find('.text').hide();
                $(this).find('input').addClass("css3");
                $(this).find(".border-l").remove();
                $(this).find(".border-r").remove();
                $(this).find('input').attr("placeholder", $(this).find('.text').html());
            })
            return;
        }

        $.each(searchBox, function () {
            if ($(this).find('input').val() != "") {
                $(this).find('.text').hide();
            }
        })
        searchBox
            .bind('mouseenter', function () {
                searchBoxHovered = true;
            })
            .bind('mouseleave', function () {
                searchBoxHovered = false;
            })
            .find('input')
        /*.focus(function () {
        searchBoxFocused = true;
        $(this).parent().find('.text').hide();
        })*/
            .blur(function () {
                searchBoxFocused = false;
                if (this.value == '')
                    $(this).parent().find('.text').show();
            })
            .end()
            .find('.text')
            .click(function () {
                $(this).parent().find('input').focus();
            });

        var clearholdtext = function (el) {
            if ($(el).val() != "") {
                $(el).parent().find('.text').hide();
            } else {
                $(el).parent().find('.text').show();
            }
        }

        searchBox.find('input').bind("input propertychange", function () {
            if (window.event == null) {
                clearholdtext(this);
                return;
            }
            var propertyName = window.event.propertyName;
            if (typeof (propertyName) == "undefined") {
                clearholdtext(this);
                return;
            }

            if (propertyName == "value") {
                clearholdtext(this);
            }
        });

        /* searchBox.find('input').bind("input propertychange", function () {
        if (window.event == null) {
        clearholdtext(this);
        return;
        }
        var propertyName = window.event.propertyName;
        if (typeof (propertyName) == "undefined") {
        clearholdtext(this);
        return;
        }
        if (propertyName == "value") {
        clearholdtext(this);
        }
        });*/
    };

    /*图片列表上下页*/
    $.fn.piclist = function (settings) {
        var defaultSettings = {
            isall: true,
            index: 0,
            pagesize: 4,
            animation: true,
            thumbWidth:140,
            disableshow:true,
            prevEl:$(this).find(".pre"),
            nextEl:$(this).find(".next"),
            thumbList:$(this).find("li"),
            thumb:$(this).find(".listitem-h"),
            thumbWrap:$(this).find(".container")
        }
        $.fn.calculatethumbBox(defaultSettings);
    };


    /*文字滚动跑马灯效果*/
    $.fn.rollscroll = function (settings) {
        if ($(this).length == 0) return;
        var defaultSettings = {
            bedinEl: $("#scroll_begin"),
            endEl: $("#scroll_end"),
            circle: true
        }
        var options = $.extend(true, defaultSettings, settings);
        var speed = 50;
        var leftS = 0;
        var scroll_begin = options.bedinEl;
        var scrollwidth = scroll_begin.width();
        var containerwidth = $(this).width();
        //内容小于滚动宽度不滚动
        if (scrollwidth <= containerwidth)
            return;
        var scroll_end = options.endEl;
        var scroll_div = $(this);
        if (options.circle) {
            scroll_end.html(scroll_begin.html());
            scroll_end.css("left", scrollwidth + "px");
        }
        function Marquee() {
            var beginleftvalue = scroll_begin.position().left.toFixed(1);
            var endleftvalue = scroll_end.position().left.toFixed(1);
            if (options.circle) {
                var beginscrollLeft =beginleftvalue-1;
                var endscrollLeft = endleftvalue-1;
                if ((-beginleftvalue) > scrollwidth) {
                    beginscrollLeft = scrollwidth;
                    endscrollLeft = 0;
                }
                if ((-endscrollLeft) > scrollwidth) {
                    endscrollLeft = scrollwidth;
                    beginscrollLeft = 0;
                }
                scroll_begin.css("left", beginscrollLeft + "px");
                scroll_end.css("left", endscrollLeft + "px");

            } else {
                beginscrollLeft = beginleftvalue-1;
                if ((-beginleftvalue) >= scrollwidth) {
                    beginscrollLeft = 0;
                }
                scroll_begin.css("left", beginscrollLeft+ "px");
            }
        }
        var MyMar = setInterval(Marquee, speed);
        scroll_div.mouseover(function () { clearInterval(MyMar); });
        scroll_div.mouseout(function () { MyMar = setInterval(Marquee, speed); });
    };

    /*回到顶部*/
    $.fn.scrolltop = function (settings) {
        if ($(this).length == 0) return;
        var el = this;
        var defaultSettings = {
            scrollheight:100
        }
        var options = $.extend(true, defaultSettings, settings);
        window.onscroll =window.onresize= function () {
            if (document.documentElement.scrollTop + document.body.scrollTop > options.scrollheight) {
                $(el).show();
            }
            else {
                $(el).hide();
            }
        }
        return this.each(function () {
            $(this).click(function () {
                //$(window).scrollTop(0);
                $("html,body").animate({ scrollTop: 0 }, 500);
            });
        });
    };

    //侧边栏菜单
    $.fn.sidemenu = function (settings) {
        if ($(this).length == 0)
            return;
        var defaultSettings = {
            value: -110,
            direction:"left",
            beginspeed: 0,
            hidespeed: 500,
            showspeed: 500
        }
        var options = $.extend(true, defaultSettings, settings);
        var el = this;
        function hidemenu() {
            $(el).animate({ left: options.left + 'px' }, options.hidespeed);
        } var timeout = null;
        if (options.beginspeed == 0)
            $(el).css(options.direction,options.value + 'px');
        else
            timeout = setTimeout(hidemenu, options.beginspeed);
        return this.each(function () {
            $(this).bind('mouseenter', function () {
                clearTimeout(timeout);
                $(el).stop();
                if(options.direction=="left")
                    $(el).animate({ left: '0px' }, options.showspeed);
                else
                    $(el).animate({ right: '0px' }, options.showspeed);
            })
            .bind('mouseleave', function () {
                $(el).stop();
                if(options.direction=="left")
                    $(el).animate({ left: options.value + 'px' }, options.hidespeed);
                else
                    $(el).animate({ right: options.value + 'px' }, options.hidespeed);
            });
        });
    };

    $.fn.xlselect = function (settings) {
        var defaultSettings = {
            expand: false,
            width: "1"
        }
        return;
        var options = $.extend(true, defaultSettings, settings);
        var selects = $(this); //获取select
        selects.css({ width: 0, height: 0, border: 0, margin: "0 0 0 -10px" });
        var createSelect = function (select_container, index) {
            //创建select容器，class为select_box，插入到select标签前
            var tag_select = $('<div></div>'); //div相当于select标签
            tag_select.attr('class', 'select_box');
            tag_select.insertBefore(select_container);
            //显示框class为select_showbox,插入到创建的tag_select中
            var select_showbox = $('<div></div>'); //显示框
            select_showbox.attr('class', 'select_showbox ellipsis').appendTo(tag_select);
            //创建option容器，class为select_option，插入到创建的tag_select中
            var ul_option = $('<ul></ul>'); //创建option列表
            ul_option.attr('class', 'select_option');
            if (options.expand) {
                ul_option.css({ position: "relative" });
            } else {
                ul_option.css({ position: "absolute" });
            }
            ul_option.appendTo(tag_select);
            createOptions(index, ul_option); //创建option
            //设置控件宽度
            if (options.width = "1") {
                tag_select.width(ul_option.outerWidth());
            } else {
                tag_select.width(options.width);
            }
            //点击显示框
            tag_select.on('click', function () {
                if (!options.expand) {
                    $(".select_option").hide();
                }
                ul_option.show();
            });

            //点击选中
            var li_option = ul_option.find('li');
            li_option.on('click', function (e) {
                $(this).addClass('selected').siblings().removeClass('selected');
                var value = $(this).text();
                select_showbox.text(value).attr("title", value);
                //设置select选中状态
                var selectedindex = li_option.index(this);
                var xselect = select_showbox.parent().next();
                var selected = xselect.find("option:eq(" + selectedindex + ")");
                xselect.find("option").attr("selected", false);
                selected.attr("selected", true);
                xselect.val(selected.val());
                ul_option.hide();
                xselect.change();
                e.stopPropagation();
            });

            //失去焦点
            $(document).on("mousedown", function (e) {
                if ($(".select_box").has(e.srcElement).length == 0)
                    ul_option.hide();
            });

            li_option.hover(function () {
                $(this).addClass('hover').siblings().removeClass('hover');
            }, function () {
                li_option.removeClass('hover');
            });
        }

        var createOptions = function (index, ul_list) {
            //获取被选中的元素并将其值赋值到显示框中
            var options = selects.eq(index).find('option'),
                selected_option = options.filter(':selected'),
                selected_index = selected_option.index(),
                showbox = ul_list.prev();
            var text = selected_option.text();
            showbox.text(text).attr("title", text);
            //为每个option建立个li并赋值
            for (var n = 0; n < options.length; n++) {
                var tag_option = $('<li></li>'), //li相当于option
                    txt_option = options.eq(n).text();
                tag_option.text(txt_option).css('cursor', 'pointer').appendTo(ul_list);
                //为被选中的元素添加class为selected
                if (n == selected_index) {
                    tag_option.attr('class', 'selected');
                }
            }
        }

        selects.each(function (i) {
            var prev = $(this).prev();
            if (prev.hasClass("select_box"))
                prev.remove();
            createSelect(this, i);
        });

    };

    /*模糊搜索*/
    $.fn.xlautocomplete=$.fn.xlAutocomplete = function (settings) {
        if ($(this).length == 0) return;
        var defaultSettings = {
            url: "",
            isdropdown: true,
            action: 'actionID',
            keyword: "Id",
            onSelect: function (suggestion) { },
            selectdata: null, //virtualdata.autocompletedata,
            paramName: 'strName'
        }
        var options = $.extend(true, defaultSettings, settings);
        var el = this;
        $(el).addClass("x-dropdown");
        if (options.selectdata == null || options.selectdata.length == 0)
            return this;

        $(el).attr(options.action, '');
        $(el).keydown(function () {
            $(this).attr(options.action, "");
        });

        if (options.isdropdown) {
            $(el).autocomplete({
                minChars: 0,
                lookup: options.selectdata,
                onSelect: function (suggestion) {
                    $(el).attr(options.action, suggestion[options.keyword]);
                    options.onSelect(suggestion);
                }
            });
        }
        else {
            $(el).autocomplete({
                serviceUrl: options.url,
                paramName: options.paramName,
                transformResult: function (response) {
                    var data = x.toJson(response);
                    if (data == null)
                        return { suggestions: {} };
                    return {
                        suggestions: $.map(data, function (dataItem) {
                            return { value: dataItem.value, Id: dataItem.Id };
                        })
                    };

                },
                onSelect: function (suggestion) {
                    $(el).attr(options.action, suggestion[options.keyword]);
                    options.onSelect(suggestion);
                }
            });
        }
    }


    $.fn.xldialog = function (settings) {
        var defaultSettings = {
            width: "auto",
            height: "auto",
            title: "弹出框",
            skin: "xldialog_box",
            draggable:false,
            etitle: "",
            contenttype: "", //iframe:地址 content:自定义对象 message:信息提示 null/"":自定义对象不使用固定的样式
            content: "",
            iframeUrl: "http://www.baidu.com", //d
            timeout: 0,
            buttontype:1, //0:默认没有按钮 1:确定取消按钮 2:自定义按钮
            onok: null,
            oncancel: null,
            okvalue: "确定",
            cancelvalue: "取消",
            showCancel: true,
            showOk: true,
            buttons: [
                {
                    text: "取消", xclass: "cancel", onClose: function () { alert(2); }
                },
                {
                    text: "确定3", xclass: "ok", onClose: function () { alert(1); }
                }],
            messagetype: "error", //error:错误提示 right:正确提示 warning:警告提示 question:问题提示 custom:自定义提示 null/"":不使用message提示
            locationable: false,
            centerX: true,
            centerY: false,
            top: "25%",
            left: "35%"
        }
        var options = $.extend(true, defaultSettings, settings);
        var el = $(this);
        var dialogindex = parseInt(typeof ($(window).data("dialogindex")) == "undefined" ? 0 : $(window).data("dialogindex")) + 1;
        $(window).data("dialogindex", dialogindex);
        var indexClass = "blockIndex" + dialogindex;
        var title = options.title;
        var width = options.width == "auto" ? options.width : options.width.toString().replace("px", "") + "px";
        var height = options.height == "auto" ? options.height : options.height.toString().replace("px", "") + "px"; ;
        var titlehtml = '<div class="toptitle"><span class="title">' + title + '</span><span class="etitle">' + options.etitle + '</span><div class="location"><a class="close"></a></div></div>'
        var contenthtml = '<div class="content" style="height:auto"><div class="dialogcontent" style="height:' + height + '"></div></div>';
        var outer = '<div  style="width:' + width + '" class="' + options.skin + '">' + titlehtml + contenthtml + '</div>';
        var dialogcontent = options.content;
        if (options.contenttype == "message") {
            var content = options.content;
            var msgico = "ico " + options.messagetype;
            switch (options.messagetype) {
                case "error":
                    {
                        content = content == "" ? "错误信息！" : content;
                    }
                    break;
                case "right":
                    {
                        content = content == "" ? "正确信息！" : content;
                    }
                    break;
                case "warning":
                    {
                        content = content == "" ? "警告信息！" : content;
                    }
                    break;
                case "question":
                    {
                        content = content == "" ? "问题信息！" : content;
                    }
                    break;
                default:
                    {
                        msgico = "";
                    }
            }
            var messagehtml = '<div class="message"><div class="' + msgico + '"></div><div class="messagetext">' + content + '</div><div style="clear:both"></div></div>';
            dialogcontent = messagehtml;
        }

        if (options.contenttype == "iframe") {
            var iframehtml = '<iframe src="' + options.iframeUrl + '" frameborder="0" scrolling="auto" allowTransparency="true"></iframe>';
            dialogcontent = iframehtml;
        }
        var isContent = false;
        if (typeof (options.content) == 'object') {
            isContent = true;
        }
        if(el.length==1)
        {
            options.centerX=options.centerY=false;
            options.left=options.top=0;
            //options.left=el.offset().left-document.body.scrollLeft;
            //options.top=el.offset().top-document.body.scrollTop+el.height();
        }
        $.blockUI({ message: dialogcontent,
            blockindex: indexClass,
            timeout: options.timeout,
            outer: outer,
            isContent: isContent,
            centerX: options.centerX,
            centerY: options.centerY,
            css: { top: options.top, left: options.left }
        }
        );
        var xldialog = $("." + indexClass);
        //定位弹出框位置
        if(el.length==1)
        {
            var setdialogPos=function()
            {
                var contentleft=el.offset().left-document.body.scrollLeft- xldialog.outerWidth()/2+el.outerWidth()/2;
                var contenttop=el.offset().top-document.body.scrollTop+el.height()+10;
                xldialog.find(".xldialog_box").css({"top":contenttop+"px","left":contentleft+"px","position":"relative"});
            }
            setdialogPos();
            $(window).scroll(function(){
                setdialogPos();
            });

            $(window).resize(function(){
                setdialogPos();
            });
        }
        //添加关闭操作
        xldialog.find(".close").click(function () {
            $.unblockUI({ blockEl: xldialog });
        });

        //添加窗口可拖动操作
        if(options.draggable)
        {
            xldialog.find(".toptitle").css("cursor","move");
            xldialog.find(".xldialog_box").draggable({ handle: ".toptitle"});//containment
        }

        //添加确定取消按钮
        var contentEl = xldialog.find(".content");
        if (options.buttontype == 1) {
            contentEl.append('<div class="btnarea"></div>');
            var btnareaEl = contentEl.find("div.btnarea");

            if (options.showOk) {
                var okhtml = '<input type="button" class="x-button ok" value="' + options.okvalue + '"/>';
                btnareaEl.append(okhtml);
                $(btnareaEl).find(".ok").click(function () {
                    var result = options.onok;
                    if (result == null)
                        $.unblockUI({ blockEl: xldialog });
                    else
                        result(xldialog);
                });
            }

            if (options.showCancel) {
                var cancelhtml = '<input type="button" class="x-button cancel" value="' + options.cancelvalue + '"/>';
                btnareaEl.append(cancelhtml);
                $(btnareaEl).find(".cancel").click(function () {
                    var result = options.oncancel;
                    if (result == null)
                        $.unblockUI({ blockEl: xldialog });
                    else
                        result(xldialog);
                });
            }
        }

        //添加自定义按钮
        if (options.buttontype == 2) {
            contentEl.append('<div class="btnarea"></div>');
            var btnareaEl = contentEl.find("div.btnarea");
            $.each(options.buttons, function (n, item) {
                var btnhtml = '<input type="button" index="' + n + '" class="x-button ' + item.xclass + '" value="' + item.text + '"/>';
                btnareaEl.append(btnhtml);
            });
            //添加自定义按钮事件
            $(btnareaEl).find(".x-button").click(function () {
                var index = $(this).attr("index");
                options.buttons[index].onClose();
            });
        }

        if ($.browser.msie && ($.browser.version == "7.0"||$.browser.version == "8.0")) {
            var headwidth = options.width;
            if (options.width == "auto") {
               contentEl.css("position", "absolute");
               contentEl.css("display", "block");
               headwidth = contentEl.outerWidth();
            }
            contentEl.width(headwidth);
            contentEl.find("div.btnarea").width(headwidth);
            var contentwidth = contentEl.outerWidth();
            xldialog.find(".toptitle").width(contentwidth);
            xldialog.css("margin-left", -headwidth / 2);
         }

        return xldialog;
    }

    /*Alert事件 Start*/
    jQuery.fn.xlAlert = function (message, timeout, messagetype, showOk) {
        if (!arguments[1]) timeout = 0;
        if (!arguments[2]) messagetype = null;
        // if (!arguments[3]) showOk = false; else showOk = true;
        if (typeof arguments[3] == "undefined") showOk = true;

        var _boxAlert = $.fn.xldialog({ buttontype: 0,
            contenttype: "message",
            content: message,
            title: "提示",
            width: "260",
            timeout: timeout,
            messagetype: messagetype,
            showCancel: false,
            buttontype: showOk ? 1 : 0
        });
        return _boxAlert;
    };
    /*Alert事件 end*/

    /*confirm事件 Start*/
    jQuery.fn.xlConfirm = function (message, func) {
        $.fn.xldialog({ buttontype: 1,
            contenttype: "message",
            messagetype: "question",
            title: "提示",
            content: message,
            onok: function ( dialogel) {
                if (func != null)
                    func();
                //$.unblockUI();
                $.unblockUI({ blockEl: dialogel });
            }
        });
    };
    /*confirm事件 end*/

    /*列表控件*/
    $.fn.xldataTable = function (settings) {
        if ($(this).length == 0) return;
        var defaultSettings = {
            url: "",
            params: function (d) { },
            data: null,
            filter:false,
            sort:false,
            //order:[[0,'asc']],
            colfilter:false,
            operateColumn: null,
            skin:"",
            editorColumn: {
                "title": "操作",
                "class": "edit-control",
                "width":"1",
                "orderable": false,
                "data": null,
                "orderData":2,
                "defaultContent": ""
            },
            //自定义编辑列的内容
            editor: "<div class='editor3'><a class='edit'></a><a class='putinto'></a><a class='downl'></a></div>",
            createdRow: function (row, data, index) { },
            columns: null,
            language: {
                "lengthMenu": "每页显示 _MENU_ 条",
                "zeroRecords": "没有数据",
                "info": "从 _START_ 到 _END_ 条,总共 _TOTAL_ 条记录",
                "infoEmpty": "没有记录",
                "sInfoFiltered": "(_MAX_总条目筛选)",
                "processing": "正在加载...",
                "sSearch":"搜索: ",
                oPaginate: {
                    sFirst: "&nbsp",
                    sLast: "&nbsp",
                    sNext: "&nbsp",
                    sPrevious: "&nbsp"
                }
            },
            fnHeaderCallback:null,
            options:null
        }
        var options = $.extend(true, defaultSettings, settings);
        var el = this;
        var dt = null;
        var tableid = $(el).attr("id");
        var newcolumns = options.columns;
        if (options.operateColumn != "" && options.operateColumn != null) {
            newcolumns.push(options.editorColumn);
        }
        if(options.colfilter)
        {
            newcolumns.splice(0, 0,{ "title": "",width:"30", "data": null, "class": "center","orderable":false,"defaultContent": "","orderData":2});
        }

        var HeaderCallback=function(head, data, start, end, display){
            var firstth=$(head).find("th:eq(0)");
            var allth=$(head).find("th");
            var notfirstth=$(head).find("th:not(:eq(0))");

            if(options.colfilter)
            {
                if(!firstth.hasClass("colfilter"))
                {
                    firstth.addClass("colfilter");
                    var strli='';
                    notfirstth.each(function(n){
                        var index=n+1;
                        strli+='<li>'+'<input type="checkbox"  checked="true" index="'+index+'"/>'+$(this).text()+'</li>';
                    })
                    $(head).after('<div class="colfilter-section"><ul>'+strli+'</ul></div>');
                    var api = this.api();
                    var sectionel=$(head).parent().find(".colfilter-section")
                    var checkboxel=sectionel.find("input");
                    checkboxel.on("click", function () {
                        var index=$(this).attr("index");
                        if ($(this).is(':checked')) {
                            api.column(index).visible(true);
                        } else {
                            api.column(index).visible(false);
                        }
                    });
                    firstth.click(function(){
                        if(sectionel.is(":hidden"))
                            sectionel.show();
                        else
                            sectionel.hide();
                    });
                    document.onclick = function (e) {
                        e = window.event || e; // 兼容IE7
                        obj = $(e.srcElement || e.target);
                        if(sectionel.find(obj).length==0)
                        {
                            if(!firstth.is(obj))
                                if(!sectionel.is(obj))
                            sectionel.hide();
                        }

                    };
                }
                if (options.sort && $(head).find(".sortico").length == 0) {
                    notfirstth.append('<span class="sortico"></span>');
                }
            }else {
                if (options.sort && $(head).find(".sortico").length == 0) {
                        allth.append('<span class="sortico"></span>');
                }
            }

            if(!options.fnHeaderCallback==null)
                options.fnHeaderCallback(head, data, start, end, display);
        }
        var createdRow = function (row, data, index) {
            if (options.operateColumn != "" && options.operateColumn != null) {
                var length = options.operateColumn.length;
                var html = '<div class="editcontent editor1"></div>';
                if (length > 1) {
                    var width =length*34;
                    html = '<div class="editcontent" style="width:' + width + 'px"></div>';
                }

                $('td.edit-control', row).append(html);
                $.each(options.operateColumn, function (n, item) {
                    var ahtml = '<a title="' + item.title + '" class="' + item.xclass + '"></a>';
                    $('td.edit-control', row).find(".editcontent").append(ahtml);
                    var operbutton=$('td.edit-control', row).find("a." + item.xclass);
                    operbutton.click(function () {
                        item.onSuccess(row, data, index,this);
                    });
                });
            } else {
                $('td.edit-control', row).append(options.editor);
            }
            options.createdRow(row, data, index);
        };
        var newoptions=null;
        if (options.data!=null) {
            newoptions={
                "sPaginationType": "full_numbers",
                "data": options.data,
                //"scrollY":"200px",
                "filter": options.filter,
                "bSort": options.sort,
                "language": options.language,
                "columns": newcolumns,
                "order": options.order,
                "createdRow": createdRow,
                "fnHeaderCallback":HeaderCallback
            };
        } else {
            newoptions={
                "sPaginationType": "full_numbers",
                "filter": options.filter,
                "bSort": options.sort,
                "destroy": true,
                "language": options.language,
                "columns": newcolumns,
                "order": options.order,
                "processing": true,
                "serverSide": true,
                "ajax": {
                    "url": options.url,
                    "data": function (d) {
                        options.params(d);
                    }
                },
                "createdRow": createdRow,
                "fnHeaderCallback":HeaderCallback
            };
        }
        newoptions=$.extend(true,newoptions,options.options);
        dt = $(el).DataTable(newoptions);
        //调整元素
        $("#" + tableid + "_length").appendTo($("#" + tableid + "_wrapper")).show();
        $("#" + tableid + "_wrapper").addClass(options.skin);
        dt.refresh=function(newdata)
        {
            dt.clear();
            var osettings=dt.context[0];
            var api=osettings.oApi;
            if(newdata!=null) {
                $.each(newdata, function (n, i) {
                    api._fnAddData(osettings, i);
                });
            }
            dt.draw();

        }
        return dt;
    }

    /*树节点*/
    $.fn.xlzTree = function (settings) {
        if ($(this).length == 0) return;
        var setting = {
            check: {
                enable: true
            },
            data: {
                simpleData: {
                    enable: true
                }
            }
        };
        var el = this;
        $.fn.zTree.init($(el), setting, virtualdata.treedata);
        var treeId = $(el).attr("id");
        var zTree = $.fn.zTree.getZTreeObj(treeId);
        zTree.setting.check.chkboxType = { "Y": "ps", "N": "ps" };
    }

    /*分页控件*/
    $.fn.pagination = function (settings) {
        if ($(this).length == 0) return;
        var defaultSettings = {
            pageIndex: 1,
            pageSize: 12,
            url: "",
            data:null,
            doc: document,
            ellipsislenght: 7, //省略中间的页数个数、0为没有省略
            nodata: "没有数据", //为null不显示
            processing: "正在加载", //为null不显示
            onepagehide: true,
            pagingEl: $(".paging_full_numbers span"),
            pagingCss:"",
            createDetail: null,
            onSuccess: null,
            parameter: null
        };
        var options = $.extend(true, defaultSettings, settings);
        var parentEl = $(this);
        var doc = options.doc;
        var pageButton = $(options.pagingEl, doc);
        $(".paging_full_numbers", doc).addClass(options.pagingCss);
        parentEl.empty();
        pageButton.empty();
        var data = null;
        var ajaxpara = typeof (options.parameter) == "function" ? options.parameter() : options.parameter;
        var para = $.extend(true, ajaxpara, { pageIndex: options.pageIndex }, { pageSize: options.pageSize });
        var outerEl = $(parentEl.parent(), doc);
        if (options.processing != null) {
            var progresshtml = '<div id="xltParentsTable_processing" class="dataTables_processing">' + options.processing + '...</div>';
            var processingEl = $("#xltParentsTable_processing", doc);
            if (processingEl.length == 1) {
                processingEl.show();
            } else {
                outerEl.before(progresshtml);
                processingEl = $("#xltParentsTable_processing", doc);
            }
        }
        if (options.data!=null) {
            var totalcount=options.data.length;
            var pageindex=parseInt(options.pageIndex);
            var totalpage=Math.ceil(totalcount/options.pageSize);
            var startindex=(pageindex-1)*options.pageSize;
            var endindex=startindex+options.pageSize;
            if(pageindex==totalpage)
            {
                endindex=options.data.length;
            }
            var currentdata=options.data.slice(startindex,endindex);
            data={countNum:totalcount,aaData:currentdata};
        } else {
            if (options.url == "") {
                alert("服务器地址不正确");
                return;
            }
            data = x.getdata(options.url, para);
        }

        //数据为空隐藏分页按钮
        if (data == null || data.countNum == 0) {
            $(".paging_full_numbers", doc).hide();
            $(".bottomborder", doc).hide();
            if (options.nodata != null) {
                if (outerEl.is("table")) {
                    var headcount = $("thead th", outerEl).length;
                    var nohtml = '<tr><td colspan="' + headcount + '" class="nodata">' + options.nodata + '</td></tr>';
                    parentEl.append(nohtml);
                }
            }
        } else {
            //加载数据
            $.each(data.aaData, function (n, item) {
                if (n > options.pageSize)
                    return;
                options.createDetail(parentEl, item, n);
            });

            //加载页码
            var totalpage = Math.ceil(data.countNum / options.pageSize);
            if (pageButton != null) {
                //设置数据为一页可以隐藏分页按钮
                if (options.onepagehide && totalpage == 1) {
                    $(".paging_full_numbers", doc).hide();
                    $(".bottomborder", doc).hide();
                } else {
                    $(".paging_full_numbers", doc).show();
                    $(".bottomborder", doc).show();
                }

                //页码多时省略
                var ellipsislenght = options.ellipsislenght;
                var currentIndex = options.pageIndex;
                if (totalpage > ellipsislenght && ellipsislenght >= 5) {
                    var ellipsisCount = ellipsislenght - 2;
                    var centerCount = ellipsislenght - 2 - 2;
                    var befroeMax = ellipsisCount;
                    var afterMin = totalpage - ellipsisCount + 1;

                    var isbefore = currentIndex >= 1 && currentIndex <= befroeMax;
                    var isafter = currentIndex >= afterMin && currentIndex <= totalpage;
                    var iscenter = currentIndex > befroeMax && currentIndex < afterMin;
                    if (befroeMax >= afterMin && currentIndex <= befroeMax) {
                        isbefore = true;
                        isafter = false;
                    }

                    if (isbefore) {
                        for (var i = 1; i <= befroeMax; i++) {
                            var current = i == currentIndex ? "current" : "";
                            pageButton.append('<a class="paginate_button ' + current + '"  data-dt-idx="' + i + '" >' + i + '</a>');
                        }
                        pageButton.append('<span>&hellip;</span>');
                        pageButton.append('<a class="paginate_button"  data-dt-idx="' + totalpage + '" >' + totalpage + '</a>');
                    }

                    if (isafter) {
                        pageButton.append('<a class="paginate_button"  data-dt-idx="' + 1 + '" >' + 1 + '</a>');
                        pageButton.append('<span>&hellip;</span>');
                        for (var i = afterMin; i <= totalpage; i++) {
                            var current = i == currentIndex ? "current" : "";
                            pageButton.append('<a class="paginate_button ' + current + '"  data-dt-idx="' + i + '" >' + i + '</a>');
                        }
                    }

                    if (iscenter) {
                        var centerMax = parseInt(currentIndex) + parseInt(centerCount);
                        pageButton.append('<a class="paginate_button"  data-dt-idx="' + 1 + '" >' + 1 + '</a>');
                        pageButton.append('<span>&hellip;</span>');
                        for (var i = currentIndex; i < centerMax; i++) {
                            var current = i == currentIndex ? "current" : "";
                            pageButton.append('<a class="paginate_button ' + current + '"  data-dt-idx="' + i + '" >' + i + '</a>');
                        }
                        pageButton.append('<span>&hellip;</span>');
                        pageButton.append('<a class="paginate_button" data-dt-idx="' + totalpage + '" >' + totalpage + '</a>');
                    }

                } else {
                    for (var i = 1; i <= totalpage; i++) {
                        var current = i == currentIndex ? "current" : "";
                        pageButton.append('<a class="paginate_button ' + current + '"  data-dt-idx="' + i + '" >' + i + '</a>');
                    }
                }
            }
        }
        //完成后调用
        if (options.processing != null) {
            window.setTimeout(function () { processingEl.hide(); }, 200);
        }
        if (options.onSuccess != null) {
            options.onSuccess(data);
        }

        var detail = {
            data: data,
            options: options,
            el: parentEl,
            refresh: function (setting) {
                options.pageIndex=0;
                var newoptions = $.extend(false, options, setting);
                parentEl.pagination(newoptions);
            }
        }

        /*事件S*/
        //点击页数
        $(".paging_full_numbers span .paginate_button", doc).click(function () {
            var index = $(this).attr("data-dt-idx");
            detail.refresh({ pageIndex: index });
        });
        //上一页
        $(".paging_full_numbers .previous", doc).unbind("click").click(function () {
            var currentindex = $(".paging_full_numbers span .current", doc).attr("data-dt-idx");
            var index = "";
            if (currentindex == 1)
                index = 1;
            else
                index = parseInt(currentindex) - 1;
            detail.refresh({ pageIndex: index });
        });
        //下一页
        $(".paging_full_numbers .next", doc).unbind("click").click(function () {
            var currentindex = $(".paging_full_numbers span .current", doc).attr("data-dt-idx");
            var index = "";
            if (currentindex == totalpage)
                index = currentindex;
            else
                index = parseInt(currentindex) + 1;
            detail.refresh({ pageIndex: index });
        });
        //首页
        $(".paging_full_numbers .first", doc).unbind("click").click(function () {
            var index = 1;
            detail.refresh({ pageIndex: index });
        });
        //末页
        $(".paging_full_numbers .last", doc).unbind("click").click(function () {
            var index = totalpage;
            detail.refresh({ pageIndex: index });
        });
        /*事件E*/

        return detail;
    }

    /*表情控件S*/
    $.fn.emotionArry=[
            {name:"默认表情",sign:"default",dir:"default",rule:"default/$1",extension:".gif",count:75,rowcount:15},
            {name:"宝宝表情",sign:"baby",dir:"baby",rule:"baby/$1",extension:".png",count:12,rowcount:6},
            {name:"洋葱头",sign:"yangcong",dir:"yangcong",prefix: "OnionCN_小表情_",rule:"yangcong/OnionCN_小表情_$1",extension:".gif",count:71,rowcount:18}
    ]

    $.fn.emotionArryface=[
        {name:"默认表情",sign:"default",dir:"default",rule:"default/$1",extension:".gif",count:75,colcount:11,rowcount:5},
        {name:"宝宝表情",sign:"baby",dir:"baby",rule:"baby/$1",extension:".png",count:12,colcount:6,rowcount:5},
        {name:"洋葱头",sign:"yangcong",dir:"yangcong",prefix: "OnionCN_小表情_",rule:"yangcong/OnionCN_小表情_$1",extension:".gif",count:71,colcount:8,rowcount:5}
    ]
    $.fn.emotionImage=function (settings) {
        var defaultSettings = {
            strContent: "",
            rootpath: "./images/expression/",
            emotionArry:$.fn.emotionArry
        };
        var options = $.extend(true, defaultSettings, settings);
        var str=options.strContent;
        str = str.replace(/\</g, '&lt;');
        str = str.replace(/\>/g, '&gt;');
        str = str.replace(/\n/g, '<br/>');
        var rooturl=options.rootpath;
        rooturl = typeof (rooturl) == "undefined" ? "" : rooturl;
        $.each(options.emotionArry,function(n,item){
            var regExp=new RegExp("\\["+item.sign+"_([0-9]*)\\]","g");
            str = str.replace(regExp, '<img src="' + rooturl +item.rule+item.extension+'" border="0" />');
        })
        return str;
    }
    $.fn.emotion = function (settings) {
        var defaultSettings = {
            mode: 0,
            skin:"myemotion",
            assign: 'leavetext',
            rootpath:"./images/expression/",
            emotionArry:$.fn.emotionArry
        };
        var options = $.extend(true, defaultSettings, settings);
        this.each(function(){
            var el=$(this);
            el.addClass(options.skin);
            var tabhtml="";
            $.each(options.emotionArry,function(n,item){
                var selectclass=n==0?"selected-item":"";
                tabhtml+='<div class="em em_'+item.sign+' '+selectclass+'" title="'+item.name+'" ><span class="ellipsis">'+item.name+'</span></div>';
            })
            var emhtml = '<div class="emotionhead"><span class="emotion js-emotion">表情</span><div class="emotiontab">'+tabhtml+'</div></div>';
            el.append(emhtml);
            $.each($.fn.emotionArry,function(n,item){
                var emel= $('.emotiontab .em_'+item.sign,el);
                emel.css("margin-left",n*70+'px');
                var fix=typeof (item.prefix)=="undefined"?"":item.prefix;
                emel.click(function () {
                    $('.emotiontab .em',el).removeClass("selected-item");
                    $(this).addClass("selected-item");
                    $(".emotiontab .qqFace",el).remove();
                });

                emel.qqFace({
                    id: item.sign+'facebox',
                    assign: options.assign,
                    tip: item.sign+"_",
                    count: item.count,
                    prefix:fix,
                    mode:options.mode,
                    parentel:el,
                    rowcount:item.rowcount,
                    colcount:item.colcount,
                    extension:item.extension,
                    path: options.rootpath+item.dir+"/"	//表情存放的路径
                });
            });

            $(".js-emotion",el).click(function () {
                $('.emotiontab',el).show();
                $('.emotiontab .em_default',el).click();
            });

            document.onclick = function (e) {
                e = window.event || e; // 兼容IE7
                obj = $(e.srcElement || e.target);
                if(!obj.hasClass("paginate_button"))
                {
                    if (obj.closest(".emotionhead").length == 0 || $('.emotionhead').is(obj)) {
                        $('.emotiontab').hide();
                    }
                }
            };

        });
    }
    /*表情控件E*/


    /*上下翻页*/
    $.fn.calculatethumbBox = function (settings) {
        var defaultSettings = {
            isall:false,
            index: 0,
            pagesize: 8,
            animation: true,
            thumbWidth:55,
            disableshow:false,
            direction:0,//0:横向 1:竖直
            prevEl:$("#js-thumb-prev"),
            nextEl:$("#js-thumb-next"),
            thumbList:$("#js-thumbList-ctn li"),
            thumb:$("#js-thumbList-ctn"),
            thumbWrap:$("#js-viewer-container")
        }
        var options = $.extend(true, defaultSettings, settings);
        var isall = options.isall;
        var index = options.index;
        var pagesize = options.pagesize;
        var animation = options.animation;
        var thumbWidth =options.thumbWidth;
        var imglist = $(options.thumbList);
        var container = $(options.thumbWrap);
        var thumbList = $(options.thumb);
        var prevEl =$(options.prevEl);
        var nextEl = $(options.nextEl);
        var currentleft = -(index * thumbWidth);
        var total = imglist.length;
        if(options.direction==1) {
            thumbList.height(total * thumbWidth);
            thumbList.parent().height(pagesize * thumbWidth);
            if (animation)
                thumbList.animate({ top: currentleft }, "fast");
            else
                thumbList.css({ top: currentleft });
        }else
        {
            thumbList.width(total * thumbWidth);
            thumbList.parent().width(pagesize * thumbWidth);
            if (animation)
                thumbList.animate({ left: currentleft }, "fast");
            else
                thumbList.css({ left: currentleft });
        }

        //根据index的位置判断上下页按钮状态
        {
            if(!options.disableshow)prevEl.hide();
            prevEl.addClass("predisable");
            if (total <= pagesize) {
                if(!options.disableshow) nextEl.hide();
                nextEl.addClass("nextdisable");
                return;
            }
            if (currentleft < 0) {
                prevEl.show();
                prevEl.removeClass("predisable");
            }
            else {
                nextEl.show();
                nextEl.removeClass("nextdisable");
            }

            var currenttotal = parseInt(index) + parseInt(pagesize);
            if (currenttotal < total) {
                nextEl.show();
                nextEl.removeClass("nextdisable");
            }
            else {
                if(!options.disableshow) nextEl.hide();
                nextEl.addClass("nextdisable");
            }
        }

        nextEl.unbind("click").click(function () {
            if ($(this).hasClass("nextdisable"))
                return;
            if(options.direction==1) {
                var left = thumbList.css("top").replace("px", "");
            }else {
                var left = thumbList.css("left").replace("px", "");
            }
            var index = -left / thumbWidth;
            if (isall) {
                var nextindex = parseInt(index) + parseInt(pagesize);
                options.index=nextindex;
                options.pagesize=pagesize;
                $.fn.calculatethumbBox(options);
            } else {
                var total = imglist.length;
                var oversize = total % pagesize;
                var totalindex = total - oversize;
                var nextindex = parseInt(index) + parseInt(pagesize);
                if (nextindex >= totalindex && nextindex <= total) {
                    nextindex = total - pagesize;
                }
                options.index=nextindex;
                options.pagesize=pagesize;
                $.fn.calculatethumbBox(options);
            }

        });

        prevEl.unbind("click").click(function () {
            if ($(this).hasClass("predisable"))
                return;
            if(options.direction==1) {
                var left = thumbList.css("top").replace("px", "");
            }else {
                var left = thumbList.css("left").replace("px", "");
            }
            var index = -left / thumbWidth;
            var nextindex = parseInt(index) - parseInt(pagesize);
            if (nextindex < 0) {
                nextindex = 0;
            }
            options.index=nextindex;
            options.pagesize=pagesize;
            $.fn.calculatethumbBox(options);

        });
    }

})(jQuery);



